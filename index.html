<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>í•­ì†Œë‹´ì™¸ê³¼ AI í•­ë¬¸ ìê°€ì§„ë‹¨ í”„ë¡œê·¸ë¨</title>
  <style>
    body { font-family: sans-serif; background: #f9f9f9; color: #333; padding: 20px; }
    h1 { color: #0055a5; font-size: 24px; }
    fieldset { margin-bottom: 15px; padding: 10px; border-radius: 5px; border: 1px solid #ccc; }
    legend { font-weight: bold; }
    label { display: block; margin: 5px 0; }
    .note { font-size: 0.9em; color: #555; margin-top: 5px; }
    input[type="number"] { width: 60px; }
    button { background: #0055a5; color: #fff; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin-top: 10px; }
    button:hover { background: #004080; }
    #results { margin-top: 20px; padding: 15px; background: #eef; border-radius: 5px; display: none; }
  </style>
</head>
<body>
  <h1>í•­ì†Œë‹´ì™¸ê³¼ AI í•­ë¬¸ìê°€ì§„ë‹¨</h1>
  <form id="diagnosisForm">
    <fieldset>
      <legend>1. ì—°ë ¹</legend>
      <label><input type="number" id="age" min="0" max="120" required> ì„¸</label>
    </fieldset>
    <fieldset>
      <legend>2. ì„±ë³„</legend>
      <label><input type="radio" name="gender" value="male" required> ë‚¨ì„±</label>
      <label><input type="radio" name="gender" value="female"> ì—¬ì„±</label>
    </fieldset>
    <fieldset id="femaleHistory" style="display:none;">
      <legend>3. ì—¬ì„±: ì¶œì‚° ì •ë³´</legend>
      <label><input type="checkbox" id="gaveBirth"> ì¶œì‚° ê²½í—˜</label>
      <div id="birthDetails" style="display:none; margin-left:15px;">
        <label><input type="checkbox" id="vaginalDelivery"> ìì—°ë¶„ë§Œ</label>
        <label>íšŸìˆ˜: <input type="number" id="vaginalCount" min="0"></label>
        <label><input type="checkbox" id="cSection"> ì œì™•ì ˆê°œ</label>
        <label>íšŸìˆ˜: <input type="number" id="cSectionCount" min="0"></label>
      </div>
    </fieldset>
    <fieldset>
      <legend>4. ì£¼ìš” í•­ë¬¸ ì¦ìƒ</legend>
      <label><input type="checkbox" name="symptoms" value="pain_post"> ë°°ë³€ í›„ í†µì¦</label>
      <label><input type="checkbox" name="symptoms" value="pain_unrelated"> ë°°ë³€ê³¼ ë¬´ê´€ í†µì¦</label>
      <label><input type="checkbox" name="symptoms" value="bleeding"> ì¶œí˜ˆ</label>
      <label><input type="checkbox" name="symptoms" value="discharge"> ë¶„ë¹„ë¬¼</label>
      <label><input type="checkbox" name="symptoms" value="itching"> ê°€ë ¤ì›€</label>
      <label><input type="checkbox" name="symptoms" value="swelling"> ê°‘ì‘ìŠ¤ëŸ° ë¶€ì–´ì˜¤ë¦„</label>
      <label><input type="checkbox" id="prolapseCheck"> í•­ë¬¸íƒˆì¶œ</label>
      <div id="prolapseOptions" style="display:none; margin-left:15px;">
        <label><input type="checkbox" name="prolapseDetail" value="autoReduce"> ë°°ë³€í›„ ìë™ë³µì›</label>
        <label><input type="checkbox" name="prolapseDetail" value="manualReduce"> ìˆ˜ë™ë³µì›</label>
        <label><input type="checkbox" name="prolapseDetail" value="noReduce"> ë³µì›ë¶ˆê°€</label>
      </div>
      <label><input type="checkbox" name="symptoms" value="mucus"> ì ì•¡</label>
    </fieldset>
    <fieldset>
      <legend>4-1. ì¶œí˜ˆ ì–‘ìƒ</legend>
      <label><input type="radio" name="bleedColor" value="smear"> ì†ŒëŸ‰ ë¬»ì–´ë‚¨</label>
      <label><input type="radio" name="bleedColor" value="bright"> ì„ í™ìƒ‰</label>
      <label><input type="radio" name="bleedColor" value="dark"> ê²€ë¶‰ì€ìƒ‰</label>
    </fieldset>
    <fieldset>
      <legend>5. ë°°ë³€ íšŸìˆ˜</legend>
      <label><input type="radio" name="freqType" value="normal" checked> í•˜ë£¨ 1íšŒ</label>
      <label><input type="radio" name="freqType" value="frequent"> í•˜ë£¨ 2íšŒ ì´ìƒ</label>
      <label><input type="radio" name="freqType" value="constipation"> ë³€ë¹„</label><br><br>
      <div id="normalFreq"><label>íšŸìˆ˜: <input type="number" id="freqNormal" min="0"> íšŒ/ì¼</label></div>
      <label><input type="checkbox" id="freqMixed"> ë³€ë¹„/ì„¤ì‚¬ ë°˜ë³µ</label>
      <label><input type="checkbox" id="freqChange"> ìµœê·¼ 2~3ê°œì›”ê°„ ë°°ë³€ìŠµê´€ì´ ë³€í•¨</label>
      <div class="note">â€» ìœ„ ë‘ í•­ëª©ì€ ë‹¤ë¥¸ ì„ íƒì§€ì™€ ì¤‘ë³µ ê°€ëŠ¥</div>
      <div id="frequentFreq" style="display:none;"><label>íšŸìˆ˜: <input type="number" id="freqHigh" min="0"> íšŒ/ì¼</label></div>
      <div id="constipationFreq" style="display:none;"><label>íšŸìˆ˜: <input type="number" id="freqLow" min="0"> íšŒ/ì£¼</label></div>
    </fieldset>
    <fieldset>
      <legend>6. ë°°ë³€ ì‹œê°„</legend>
      <label><input type="number" id="duration" min="0"> ë¶„</label>
    </fieldset>
    <fieldset>
      <legend>7. ë°°ë³€ ê²½ë„ (Bristol ë¶„ë¥˜)</legend>
      <label><input type="radio" name="hardness" value="1"> 1 = í† ë¼ë˜¥ì²˜ëŸ¼ ë‘¥ê¸€ë©´ì„œ ë”±ë”±í•œ ë³€</label>
      <label><input type="radio" name="hardness" value="2"> 2 = ëŠì–´ì§€ë©´ì„œ í‘œë©´ì´ ê°ˆë¼ì ¸ ìˆëŠ” ë³€</label>
      <label><input type="radio" name="hardness" value="3"> 3 = ë°”ë‚˜ë‚˜ ëª¨ì–‘ì˜ ë¶€ë“œëŸ¬ìš´ ë³€</label>
      <label><input type="radio" name="hardness" value="4"> 4 = ë¬¼ì— í’€ì–´ì§€ëŠ” ë³€</label>
      <label><input type="radio" name="hardness" value="5"> 5 = ì„¤ì‚¬</label>
    </fieldset>
    <fieldset>
      <legend>8. í•˜ë£¨ ì‹ì‚¬ íšŸìˆ˜</legend>
      <label><input type="number" id="meals" min="1" max="10"> íšŒ</label>
    </fieldset>
    <fieldset>
      <legend>9. í•˜ë£¨ ë¬¼ ì„­ì·¨ëŸ‰</legend>
      <label><input type="number" id="water" min="0"> ë³‘</label>
    </fieldset>
    <fieldset>
      <legend>10. ê³¼ê±° í•­ë¬¸ ìˆ˜ìˆ  ì´ë ¥</legend>
      <label><input type="checkbox" id="hSur"> ìˆìŒ</label>
    </fieldset>
    <fieldset>
      <legend>11. ìµœê·¼ 5ë…„ì´ë‚´ ëŒ€ì¥ë‚´ì‹œê²½ ë°›ì€ ì´ë ¥</legend>
      <label><input type="checkbox" id="colonoscopy"> ë°›ìŒ</label>
    </fieldset>
    <fieldset>
      <legend>12. ì¶”ê°€ ì¦ìƒ</legend>
      <label><input type="checkbox" name="extras" value="weightLoss"> ì²´ì¤‘ ê°ì†Œ</label>
      <label><input type="checkbox" name="extras" value="familyCRC"> ëŒ€ì¥/ì§ì¥ì•” ê°€ì¡±ë ¥</label>
      <label><input type="checkbox" name="extras" value="abPain"> ë³µí†µ</label>
      <label><input type="checkbox" name="extras" value="diarrhea"> ë§Œì„± ì„¤ì‚¬</label>
      <label><input type="checkbox" name="extras" value="fever"> ë°œì—´</label>
      <label><input type="checkbox" name="extras" value="mucusStool"> ì ì•¡ë³€</label>
      <label><input type="checkbox" name="extras" value="lowBackPain"> ìš”í†µ</label>
      <label><input type="checkbox" name="extras" value="pelvicPain"> ê³¨ë°˜í†µì¦</label>
    </fieldset>
    <fieldset>
      <legend>13. ê³¼ê±°ë ¥</legend>
      <label><input type="checkbox" name="history" value="polyps"> ìš©ì¢…</label>
      <label><input type="checkbox" name="history" value="colorectalSurgery"> ëŒ€ì¥/ì§ì¥ ìˆ˜ìˆ </label>
      <label><input type="checkbox" name="history" value="abdominalSurgery"> ë³µë¶€ ìˆ˜ìˆ </label>
      <label><input type="checkbox" name="history" value="pelvicRadiation"> ê³¨ë°˜ ë°©ì‚¬ì„ </label>
      <label><input type="checkbox" name="history" value="ibdDiagnosis"> ì—¼ì¦ì„± ì¥ì§ˆí™˜</label>
      <label><input type="checkbox" name="history" value="abscessSurgery"> ë†ì–‘ ìˆ˜ìˆ </label>
      <label><input type="checkbox" name="history" value="fistulaSurgery"> ì¹˜ë£¨ ìˆ˜ìˆ </label>
    </fieldset>
    <button type="button" onclick="runDiagnosis()">ğŸ©º ì§„ë‹¨í•˜ê¸°</button>
  </form>
  <div id="results">
    <h2>ì˜ˆìƒ ì§„ë‹¨ ê²°ê³¼</h2>
    <ul id="diagnosisList"></ul>
  </div>
  <script>
    document.querySelectorAll('input[name="gender"]').forEach(radio => {
      radio.addEventListener('change', () => {
        document.getElementById('femaleHistory').style.display = (radio.value==='female' && radio.checked) ? '' : 'none';
      });
    });
    document.getElementById('gaveBirth')?.addEventListener('change', e => {
      document.getElementById('birthDetails').style.display = e.target.checked ? '' : 'none';
    });
    document.getElementById('prolapseCheck').addEventListener('change', e => {
      document.getElementById('prolapseOptions').style.display = e.target.checked ? '' : 'none';
    });
    document.getElementsByName('freqType').forEach(radio => {
      radio.addEventListener('change', () => {
        const v = document.querySelector('input[name="freqType"]:checked').value;
        document.getElementById('normalFreq').style.display = v==='normal' ? '' : 'none';
        document.getElementById('frequentFreq').style.display = v==='frequent' ? '' : 'none';
        document.getElementById('constipationFreq').style.display = v==='constipation' ? '' : 'none';
      });
    });
    function runDiagnosis() {
      const age = Number(document.getElementById('age').value);
      const gender = document.querySelector('input[name="gender"]:checked')?.value;
      const symptoms = Array.from(document.querySelectorAll('input[name="symptoms"]:checked')).map(i=>i.value);
      const bleedColor = document.querySelector('input[name="bleedColor"]:checked')?.value;
      const prolapse = document.getElementById('prolapseCheck').checked ?
        Array.from(document.querySelectorAll('input[name="prolapseDetail"]:checked')).map(i=>i.value) : [];
      const freqType = document.querySelector('input[name="freqType"]:checked')?.value;
      const freq = freqType==='frequent'?Number(document.getElementById('freqHigh').value):freqType==='constipation'?Number(document.getElementById('freqLow').value):Number(document.getElementById('freqNormal').value);
      const freqMixed = document.getElementById('freqMixed').checked;
      const freqChange = document.getElementById('freqChange').checked;
      const duration = Number(document.getElementById('duration').value);
      const hardness = document.querySelector('input[name="hardness"]:checked')?.value;
      const hSur = document.getElementById('hSur').checked;
      const colonoscopyDone = document.getElementById('colonoscopy').checked;
      const extras = Array.from(document.querySelectorAll('input[name="extras"]:checked')).map(i=>i.value);
      const history = Array.from(document.querySelectorAll('input[name="history"]:checked')).map(i=>i.value);
      
      const scores = {
        'ì¹˜í•µ 2ê¸°':0,'ì¹˜í•µ 3ê¸°':0,'ì¹˜í•µ 4ê¸°':0,'ê¸‰ì„± í˜ˆì „ì„± ì™¸ì¹˜í•µ':0,'êµì•¡ì„± ì¹˜í•µ':0,'ê¸‰ì„± ì¹˜ì—´':0,'ë§Œì„± ì¹˜ì—´':0,'ë‹¨ìˆœ ì¹˜ë£¨':0,'ë³µì¡ ì¹˜ë£¨':0,'í•­ë¬¸ë†ì–‘':0,'ê³¼ë¯¼ì„± ëŒ€ì¥ì¦í›„êµ°':0,'ì—¼ì¦ì„± ì¥ì§ˆí™˜ ì˜ì‹¬':0,'ì§ì¥ì•” ì˜ì‹¬':0,'ëŒ€ì¥ì•” ì˜ì‹¬':0,'ì§ì¥íƒˆì¶œ':0,'ë³€ì‹¤ê¸ˆ':0,'í•­ë¬¸ì†Œì–‘ì¦':0,'ì¼ê³¼ì„± ì§ì¥í†µ':0
      };
      if(symptoms.includes('bleeding')){scores['ì¹˜í•µ 2ê¸°']+=3;scores['ê¸‰ì„± ì¹˜ì—´']+=2;}
      if(symptoms.includes('swelling')){scores['í•­ë¬¸ë†ì–‘']+=3;scores['ê¸‰ì„± í˜ˆì „ì„± ì™¸ì¹˜í•µ']+=3;}
      if(bleedColor==='smear'){scores['ê¸‰ì„± ì¹˜ì—´']+=1;scores['í•­ë¬¸ì†Œì–‘ì¦']+=1;}
      if(bleedColor==='bright'){scores['ì¹˜í•µ 2ê¸°']+=2;scores['ê¸‰ì„± ì¹˜ì—´']+=1;scores['ì—¼ì¦ì„± ì¥ì§ˆí™˜ ì˜ì‹¬']+=1;scores['ì§ì¥ì•” ì˜ì‹¬']+=1;}
      if(bleedColor==='dark'){scores['ëŒ€ì¥ì•” ì˜ì‹¬']+=3;}
      prolapse.forEach(v=>{if(v==='autoReduce'){scores['ì¹˜í•µ 3ê¸°']+=2;scores['ì¹˜í•µ 4ê¸°']+=1;}if(v==='manualReduce'){scores['ì¹˜í•µ 3ê¸°']+=3;scores['ì¹˜í•µ 4ê¸°']+=2;}if(v==='noReduce'){scores['ì¹˜í•µ 4ê¸°']+=4;scores['ì§ì¥íƒˆì¶œ']+=5;}});
      if(duration>10&&hardness<=2){scores['ê¸‰ì„± ì¹˜ì—´']+=3;}
      if(freqMixed){scores['ê³¼ë¯¼ì„± ëŒ€ì¥ì¦í›„êµ°']+=3;if(age>=50) scores['ì§ì¥ì•” ì˜ì‹¬']+=1;}
      if(freqChange){if(age<50) scores['ê³¼ë¯¼ì„± ëŒ€ì¥ì¦í›„êµ°']+=2;else{scores['ëŒ€ì¥ì•” ì˜ì‹¬']+=2;scores['ì§ì¥ì•” ì˜ì‹¬']+=2;}}
      if(extras.includes('diarrhea'))scores['ì—¼ì¦ì„± ì¥ì§ˆí™˜ ì˜ì‹¬']+=2;
      if(extras.includes('fever')||extras.includes('mucusStool'))scores['ì—¼ì¦ì„± ì¥ì§ˆí™˜ ì˜ì‹¬']+=2;
      if(gender==='female'&&document.getElementById('gaveBirth').checked&&age>=40&&symptoms.includes('pain_unrelated')&&(extras.includes('lowBackPain')||extras.includes('pelvicPain'))){scores['ì¼ê³¼ì„± ì§ì¥í†µ']+=5;}
      if(history.includes('abscessSurgery')||history.includes('fistulaSurgery'))scores['ë³µì¡ ì¹˜ë£¨']+=3;
      if((history.includes('abscessSurgery')||history.includes('fistulaSurgery'))&&freqType==='frequent'&&freq>=3&&symptoms.includes('discharge')&&symptoms.includes('pain_post'))scores['ë³µì¡ ì¹˜ë£¨']+=5;
      if(age>=50&&!colonoscopyDone&&symptoms.includes('bleeding')&&freqChange){scores['ëŒ€ì¥ì•” ì˜ì‹¬']+=3;scores['ì§ì¥ì•” ì˜ì‹¬']+=3;}
      if(extras.includes('familyCRC')){scores['ëŒ€ì¥ì•” ì˜ì‹¬']+=2;scores['ì§ì¥ì•” ì˜ì‹¬']+=2;}
      const total=Object.values(scores).reduce((s,v)=>s+Math.max(v,0),0)||1;
      const probs=Object.entries(scores).map(([d,v])=>[d,Math.round(Math.max(v,0)/total*100)]).sort((a,b)=>b[1]-a[1]);
      const list=document.getElementById('diagnosisList');list.innerHTML='';
      if(probs[0][1]<10&&freqType==='normal'&&!freqMixed&&!freqChange){const li=document.createElement('li');li.textContent='ì¼ì‹œì  ì¦ìƒìœ¼ë¡œ íŒë‹¨ë˜ë©°, ì¦ìƒ ì§€ì† ì‹œ ì „ë¬¸ì˜ ìƒë‹´ ìš”í•¨';list.appendChild(li);}else{probs.slice(0,3).forEach(([d,p])=>{const li=document.createElement('li');li.textContent=`${d}: ${p}%`;list.appendChild(li);});}
      document.getElementById('results').style.display='block';
    }
  </script>
</body>
</html>
